<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>chessfriend - Add new Game</title>
    
    <link rel="stylesheet" href="../css/common.css">
    <script src="../app/chessfriend.js"></script>
    
  </head>

  
  <body>

    <div class="game-container">

      <div class="board-view setup noRightBorder">
	<div id="game-board"></div>
      </div>

      <div class="search-view setup noLeftBorder">
	<div class="search-window">

	  <form onsubmit="return false;">
	    <div id="pieceContainer"></div>

	    <br>
	    <label>Start position from FEN:</label><br>
	    <input type="text" class="searchbox" id="FENinput" name="FENinput" value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1" oninput="insertFEN()">
	  
	    <div style="display: flex; flex-direction: row; margin-top: 8px;">

	      <div style="width: 50%; margin-right: 16px;">
		<div style="width: 100%;">
		  <label style="display: inline-block; width: 100%;">Side to move:<br>
		    <div class="customSelect">
		      <select id="stm">
			<option value="w">White</option>
			<option value="b">Black</option>
		      </select>
		    </div>
		  </label>
		</div>
	      </div>

	    
	      <div style="width: 50%;">
		<div>
		  <label>Move number:<br>
		    <input class="customInput" id="mvNr" type="number" value="1" min="1" style="width: 100%;">
		  </label>
		</div>
	      </div>

	    </div>
	    
	  </form>

	  <br>
	  <div style="text-align: center">
	    <button onclick="addNew()">Add new</button>
	  </div>

	</div>
      </div>

    </div>
  </body>
</html>



<script>

  var path = require('path')
  var boardContainer = document.getElementById('game-board')
  var FENContainer = document.getElementById('FENinput')
  var pieceContainer = document.getElementById("pieceContainer")
  var BoardHandling = require(path.join(process.cwd(), '/app/boardHandling.js'))
  var db = require(path.join(process.cwd(), '/app/chessfriendDB.js'))

  var Container = {}
  Container.boardContainer = boardContainer
  Container.FENContainer = FENContainer
  Container.pieceContainer = pieceContainer
  
  var board = new BoardHandling(window, Container, db)
  board.loadForSearch()

  
  function insertFEN() {
      var fen = FENContainer.value
      board.insertFEN(fen)
  }


  function addNew() {

      var stm = document.getElementById("stm").value
      var mvNr = document.getElementById("mvNr").value
        
      board.validateFEN(FENContainer.value, stm, mvNr, function(valid) {

       	  if (valid.valid === true) {
	      db.userSelected['startmode'] = "custom"
	      db.userSelected['startFEN'] = valid.FEN
       	      window.open('/views/game.html', '_self')
       	  } else {
       	      alert("Invalid FEN: " + valid.error)
       	  }
      })
  }


</script>
